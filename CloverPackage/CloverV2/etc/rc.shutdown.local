#!/bin/bash

#
# rc.shutdown.local shutdown script for CLOVER
#
# this script run executable scripts in rc.shutdown.d folder having .local
# extension
#
# Initial - Slice
# Edited - kozlek  2013-01-15
#        - apianti 2013-01-16
#        - JrCs    2013-02-01
#
# © Slice 2010
# © kozlek,apianti 2013
# © JrCs 2013

# Variables
selfDir=$(cd $(dirname "$0") && pwd -P)
currentDate=$(date "+%Y-%m-%d")
currentTime=$(date "+%H:%M:%S")

#
# Source clover rc library
#
source "$selfDir"/rc.clover.lib

# Check that all variables are bound
set -u

#
# Redirect all outputs to log file
#
exec &>"${CLOVER_LOG_LOCATION}"/rc.shutdown.log

#
# Print the current timestamp
#
echo "-------------------------------"
echo "DATE: ${currentDate} TIME: ${currentTime}"
echo "-------------------------------"

[[ "$DEBUG" -ne 0 ]] && set -x

# Launch some custom scripts if exists
rc_dir="${selfDir}/rc.shutdown.d"
if [[ -d "$rc_dir" ]]; then
    # Remove space from IFS
    IFS="$(printf '\n\t')"
    for script in "$rc_dir"/*.local; do
        if [[ ! -d "$script" && -x "$script" ]]; then
            echo ">> Begin Script: ${script}"
            $script
            echo ">> End Script: ${script}"
            echo
        fi
    done
fi


# Local Variables:      #
# mode: ksh             #
# tab-width: 4          #
# indent-tabs-mode: nil #
# End:                  #
#
# vi: set expandtab ts=4 sw=4 sts=4: #
